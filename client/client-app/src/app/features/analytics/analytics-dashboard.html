<div class="analytics-dashboard">
  <header class="dashboard-header">
    <div class="header-content">
      <div>
        <h1>Analytics Dashboard</h1>
        <p>Compare performance across all campaigns</p>
      </div>
      <div class="header-buttons">
        <button class="btn-segment-chart" (click)="showSegmentChart()" [disabled]="loading">
          Segment Distribution Chart
        </button>
        <button class="btn-export" (click)="exportCampaignAnalytics()" [disabled]="loading">
          Export Campaign Analytics
        </button>
      </div>
    </div>
  </header>

  <div *ngIf="loading" class="loading">Loading analytics...</div>
  <div *ngIf="error" class="alert alert-error">{{error}}</div>

  <div *ngIf="!loading && !error">
    <div class="chart-section">
      <h3>Campaign Performance Comparison</h3>
      <div class="chart-container">
        <canvas baseChart
                [data]="barChartData"
                [options]="barChartOptions"
                [type]="barChartType">
        </canvas>
      </div>
    </div>

    <div class="table-section">
      <h3>Campaign Metrics Overview</h3>
      <div class="table-container">
        <table class="metrics-table">
          <thead>
            <tr>
              <th>Campaign</th>
              <th>Total Leads</th>
              <th>Open Rate</th>
              <th>Conversion Rate</th>
              <th>Last Updated</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let metric of campaignMetrics">
              <td>{{metric.campaign.campaignName}}</td>
              <td>{{metric.totalLeads}}</td>
              <td>{{metric.openRate}}%</td>
              <td>{{metric.conversionRate}}%</td>
              <td>{{metric.lastUpdated | date:'short'}}</td>
              <td>
                <button class="btn-view" (click)="viewCampaignDetails(metric.campaign.campaignId)">
                  View Details
                </button>
              </td>
            </tr>
            <tr *ngIf="campaignMetrics.length === 0">
              <td colspan="6" class="no-data">No campaign metrics available</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Lead Segment Distribution</h3>
        <button class="btn-close" (click)="closeModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div *ngIf="segmentLoading" class="loading">Loading segments...</div>
        <div *ngIf="!segmentLoading && segmentData.length > 0" class="pie-chart-container">
          <canvas baseChart
                  [data]="pieChartData"
                  [options]="pieChartOptions"
                  [type]="pieChartType">
          </canvas>
        </div>
        <div *ngIf="!segmentLoading && segmentData.length === 0" class="no-data">
          No segment data available
        </div>
      </div>
    </div>
  </div>
</div>